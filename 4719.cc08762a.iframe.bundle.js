"use strict";(self.webpackChunknice_ui=self.webpackChunknice_ui||[]).push([[4719],{"./src/markdown/block/fen/index.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>block_fen});var react=__webpack_require__("./node_modules/react/index.js"),react_namespaceObject=__webpack_require__.t(react,2);const letterToNumber={a:0,b:1,c:2,d:3,e:4,f:5,g:6,h:7},pieceName2Letter={k:"bk",q:"bq",b:"bb",n:"bn",r:"br",p:"bp",K:"wk",Q:"wq",B:"wb",N:"wn",R:"wr",P:"wp"},twoLetterToCased={bk:"k",bq:"q",bb:"b",bn:"n",br:"r",bp:"p",wk:"K",wq:"Q",wb:"B",wn:"N",wr:"R",wp:"P"},parseExtended=function(fen){let noFen=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const layout={borders:[],lines:[],squares:[]},parts=fen.split(/\n|;/g);if(!noFen){const pieces=(fen=>{if(!(fen=>{if("string"!=typeof fen)return!1;const chunks=(fen=fen.replace(/ .+$/,"")).split("/");if(chunks.length>8)return!1;for(let i=0;i<8&&i<chunks.length;i++)if(chunks[i].length>8||-1!==chunks[i].search(/[^kqrbnpKQRNBP1-8]/))return!1;return!0})(fen))return[];const rows=(fen=fen.replace(/ .+$/,"")).split("/"),pieces=[];for(let i=0;i<8&&i<rows.length;i++){const row=rows[i].split("");let colIndex=0;for(let j=0;j<row.length;j++)if(-1!==row[j].search(/[1-8]/))colIndex+=parseInt(row[j],10);else{let piece=row[j];piece=piece.toLowerCase()===piece?"b"+piece.toLowerCase():"w"+piece.toLowerCase(),pieces.push([i,colIndex,piece]),colIndex++}}return pieces})(parts[0]);if(pieces)for(const[x,y,piece]of pieces)layout.squares.push({xy:[y,7-x],piece:twoLetterToCased[piece]})}for(let i=0;i<parts.length;i++){const part=parts[i];let match=part.match(/^\s*([a-hA-H])([0-8])\s*(<{0,50}|[oO]{0,1})\s*([\-=]{0,50})\s*(>{0,50}|[oO]{0,1})\s*([a-hA-H])([0-8])\s*:?\s*([a-zA-Z#0-9]+)?\s*,?\s*([0-9\.]+)?\s*/);if(match){const line={from:[letterToNumber[match[1].toLowerCase()],Number(match[2])-1],tipFrom:match[3],body:match[4],tipTo:match[5],to:[letterToNumber[match[6].toLowerCase()],Number(match[7])-1]};match[8]&&(line.color=match[8]),match[9]&&(line.opacity=Number(match[9])),layout.lines.push(line)}else if(match=part.match(/^\s*([a-hA-H])([0-8])\s*(:(\s*([prnbkqPRNBKQ](\s|\n|$))\s*(\s*([0-9\.]+)\s*)?\s*)?\s*([\\\/\-_]{0,4})?\s*(\s*([a-zA-Z#0-9]+)?(\s*\s*([0-9\.]+)?)?)?\s*)?/),match){const square={xy:[Number(match[2])-1,7-letterToNumber[match[1].toLowerCase()]]};match[5]&&(square.piece=pieceName2Letter[match[5].trim()]),match[8]&&(square.pieceOpacity=Number(match[8])),match[9]&&(match[9].indexOf("-")>-1&&(square.borderTop=!0),match[9].indexOf("\\")>-1&&(square.borderRight=!0),match[9].indexOf("_")>-1&&(square.borderBottom=!0),match[9].indexOf("/")>-1&&(square.borderLeft=!0)),match[11]&&(square.color=match[11]),match[13]&&(square.opacity=Number(match[13]));const existingSquare=layout.squares.find((a=>a.xy[0]===square.xy[0]&&a.xy[1]===square.xy[1]));existingSquare?Object.assign(existingSquare,square):layout.squares.push(square)}else if(match=part.match(/^\s*~\s*([a-hA-H])([0-8])(\s+([\-0-9\.]+))?(\s+([\-0-9\.]+))?(\s+([0-9\.]+))?(\s+([asdw]+))\s*(:\s*([a-zA-Z#0-9]+)?(\s+([0-9\.]+))?(\s+([0-9\.]+))?)?(\s+([a-zA-Z#0-9]+))?(\s+([0-9\.]+))?\s*/),match){const border={xy:[letterToNumber[match[1].toLowerCase()],Number(match[2])-1],segments:match[10]};match[4]&&(border.offset=[Number(match[4]),Number(match[6]||0)]),match[8]&&(border.segmentSize=Number(match[8])),match[12]&&(border.color=match[12]),match[14]&&(border.opacity=Number(match[14])),match[16]&&(border.width=Number(match[16])),match[18]&&(border.fillColor=match[18]),match[20]&&(border.fillOpacity=Number(match[20])),layout.borders.push(border)}else;}return layout.borders.length||layout.lines.length||layout.squares.length?layout:{}};var lib=__webpack_require__("./node_modules/nano-theme/lib/index.js");const Board_theme={white:"#eee",black:"#888"};var conf=__webpack_require__("./src/misc/conf.ts");const PIECES={r:conf.s+"/chess/br.png",b:conf.s+"/chess/bb.png",k:conf.s+"/chess/bk.png",n:conf.s+"/chess/bn.png",p:conf.s+"/chess/bp.png",q:conf.s+"/chess/bq.png",R:conf.s+"/chess/wr.png",B:conf.s+"/chess/wb.png",K:conf.s+"/chess/wk.png",N:conf.s+"/chess/wn.png",P:conf.s+"/chess/wp.png",Q:conf.s+"/chess/wq.png"},h=react.createElement;function mapColor(color){switch(color=color||"green"){case"green":color="#52aa05";break;case"red":color="#c6140d"}return color}let globalMarkerId=0;class Board extends react.Component{static lineCnt=0;shouldComponentUpdate(nextProps){return JSON.stringify(nextProps)!==JSON.stringify(this.props)}renderCheckers(){const checkers=[];for(let i=0;i<8;i++)for(let j=(i+1)%2;j<8;j+=2)checkers.push(react.createElement("rect",{key:`checker-${i},${j}`,x:12.5*j,y:12.5*i,height:12.5,width:12.5,style:{fill:Board_theme.black}}));return checkers}renderRuler(){const{noRuler}=this.props,ruler=[];if(noRuler)return ruler;const rulerStyle={fontFamily:"Open Sans,sans",fontWeight:"bold",textAlign:"center",lineHeight:3.125,fontSize:2.625};for(let i=0;i<8;i++)ruler.push(react.createElement("text",{x:"1.2",y:12.5*i+3.7,style:{fill:i%2?"#fff":"#000",opacity:i%2?.5:.4,...rulerStyle},key:"ruler-x"+i},8-i)),ruler.push(react.createElement("text",{y:"98.5",x:12.5*i+9.5,style:{fill:i%2?"#000":"#fff",opacity:i%2?.4:.5,...rulerStyle},key:"ruler-y"+i},(i+10).toString(18)));return ruler}renderLines(){const{props}=this,markers=[],lines=[];if(props.lines&&props.lines.length)for(let i=0;i<props.lines.length;i++){const line=props.lines[i],{from,to,tipFrom,tipTo,body}=line,color=mapColor(line.color||"green"),opacity=line.opacity||.8,strokeWidth=body?("="===body[0]?8:3)/body.length:3;let tipToId,tipFromId;if(tipTo)if(tipToId="board-marker-"+globalMarkerId++,"o"===tipTo||"O"===tipTo)markers.push(react.createElement("marker",{key:"line-"+i,id:tipToId,markerWidth:"10",markerHeight:"10",refX:"3",refY:"3",orient:"auto",markerUnits:"strokeWidth",viewBox:"0 0 25 25"},react.createElement("circle",{cx:"3",cy:"3",r:"o"===tipTo?2:3,fill:color})));else{const size=25-2*tipTo.length;markers.push(react.createElement("marker",{key:"line-"+i,id:tipToId,markerWidth:"10",markerHeight:"10",refX:"2.7",refY:"3",orient:"auto",markerUnits:"strokeWidth",viewBox:`0 0 ${size} ${size}`},react.createElement("path",{d:"M0,0 L0,6 L4.5,3 z",fill:color})))}if(tipFrom)if(tipFromId="board-marker-"+globalMarkerId++,"o"===tipFrom||"O"===tipFrom)markers.push(react.createElement("marker",{key:"line-"+i,id:tipFromId,markerWidth:"10",markerHeight:"10",refX:"3",refY:"3",orient:"auto",markerUnits:"strokeWidth",viewBox:"0 0 25 25"},react.createElement("circle",{cx:"3",cy:"3",r:"o"===tipFrom?2:3,fill:color})));else{const size=25-2*tipFrom.length;markers.push(react.createElement("marker",{key:"line-"+i,id:tipFromId,markerWidth:"10",markerHeight:"10",refX:"2.7",refY:"3",orient:"auto",markerUnits:"strokeWidth",viewBox:`0 0 ${size} ${size}`},react.createElement("path",{d:"M4.5,0 L4.5,6 L0,3 z",fill:color})))}const lineProps={key:`line-${i}`,x1:12.5*(.5+from[0]),y1:12.5*(7.5-from[1]),x2:12.5*(.5+to[0]),y2:12.5*(7.5-to[1]),markerStart:tipFromId?`url(#${tipFromId})`:void 0,markerEnd:tipToId?`url(#${tipToId})`:void 0,stroke:color,strokeWidth,style:{opacity}};lines.push(h("line",lineProps))}return[markers,lines]}renderFigures(){const figures=[],{props}=this;if(props.squares instanceof Array)for(let i=0;i<props.squares.length;i++){const square=props.squares[i];square.piece&&figures.push(react.createElement("image",{key:"figure-"+i,x:12.5*square.xy[0],y:12.5*(7-square.xy[1]),width:12.5,height:12.5,xlinkHref:PIECES[square.piece],style:{opacity:square.pieceOpacity||1}}))}return figures}renderHighlights(){const{props}=this,highlights=[];if(props.squares instanceof Array)for(let i=0;i<props.squares.length;i++){const square=props.squares[i];!square.color&&(square.piece||square.borderTop||square.borderRight||square.borderBottom||square.borderLeft)||highlights.push(react.createElement("rect",{key:"highlight-"+i,x:12.5*square.xy[0],y:12.5*(7-square.xy[1]),height:12.5,width:12.5,style:{fill:mapColor(square.color??""),opacity:square.opacity||.35}})),square.borderTop&&highlights.push(react.createElement("rect",{key:"highlight-"+i,x:12.5*square.xy[0],y:12.5*(7-square.xy[1]),height:12.5*.07,width:12.5,style:{fill:"#000",opacity:.65}})),square.borderRight&&highlights.push(react.createElement("rect",{key:"highlight-"+i,x:12.5*(square.xy[0]+1-.07),y:12.5*(7-square.xy[1]),height:12.5,width:12.5*.07,style:{fill:"#000",opacity:.65}})),square.borderBottom&&highlights.push(react.createElement("rect",{key:"highlight-"+i,x:12.5*square.xy[0],y:12.5*(8-square.xy[1]-.07),height:12.5*.07,width:12.5,style:{fill:"#000",opacity:.65}})),square.borderLeft&&highlights.push(react.createElement("rect",{key:"highlight-"+i,x:12.5*square.xy[0],y:12.5*(7-square.xy[1]),height:12.5,width:12.5*.07,style:{fill:"#000",opacity:.65}}))}return highlights}renderBorders(){const{props}=this,borders=[];if(props.borders instanceof Array)for(let i=0;i<props.borders.length;i++){const border=props.borders[i];let stepLength=12.5;border.segmentSize&&(stepLength*=border.segmentSize);let offsetX=0,offsetY=0;border.offset&&(offsetX=border.offset[0],offsetY=border.offset[1]);let d=`M${12.5*(border.xy[0]+offsetX)} ${12.5*(7-border.xy[1]+offsetY)} l`;for(let j=0;j<border.segments.length;j++)switch(border.segments[j]){case"d":d+=stepLength+" 0 ";break;case"s":d+="0 "+stepLength+" ";break;case"a":d+=-stepLength+" 0 ";break;case"w":d+="0 "+-stepLength+" "}const strokeWidth=1.8*(border.width||1),strokeColor=mapColor(border.color||"orange"),strokeOpacity=border.opacity||.75,fillColor=border.fillColor||"none",fillOpacity=border.fillOpacity||.4;borders.push(react.createElement("path",{key:"border-"+i,d,strokeLinejoin:"round",style:{strokeWidth,stroke:strokeColor,strokeOpacity,fill:fillColor,fillOpacity}}))}return borders}render(){const[markers,lines]=this.renderLines();return react.createElement("svg",{viewBox:"0 0 100 100"},react.createElement("defs",null,markers),react.createElement("rect",{x:"0",y:"0",height:"100",width:"100",style:{fill:Board_theme.white}}),this.renderCheckers(),this.renderHighlights(),this.renderBorders(),this.renderFigures(),this.renderRuler(),lines)}}const chess_Board=Board;try{Board.displayName="Board",Board.__docgenInfo={description:"",displayName:"Board",props:{size:{defaultValue:null,description:"",name:"size",required:!1,type:{name:"enum",value:[{value:"0"},{value:"1"},{value:"2"},{value:"3"},{value:"-3"},{value:"-2"},{value:"-1"}]}},noRuler:{defaultValue:null,description:"",name:"noRuler",required:!1,type:{name:"boolean"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"((e: MouseEvent<Element, MouseEvent>) => void)"}},onRightClick:{defaultValue:null,description:"",name:"onRightClick",required:!1,type:{name:"((e: MouseEvent<Element, MouseEvent>) => void)"}},lines:{defaultValue:null,description:"",name:"lines",required:!1,type:{name:"ILine[]"}},squares:{defaultValue:null,description:"",name:"squares",required:!1,type:{name:"ISquare[]"}},borders:{defaultValue:null,description:"",name:"borders",required:!1,type:{name:"IBorder[]"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/markdown/components/chess/Board/index.tsx#Board"]={docgenInfo:Board.__docgenInfo,name:"Board",path:"src/markdown/components/chess/Board/index.tsx#Board"})}catch(__react_docgen_typescript_loader_error){}const blockClass=(0,lib.rule)({maxW:"600px","min-width":"130px",mar:"0 auto",bdrad:"3px",ov:"hidden",svg:{d:"block"},".chess-board":{bdr:"1px solid rgba(0,0,0,.15)",bdl:"1px solid rgba(0,0,0,.1)",bdb:"1px solid rgba(0,0,0,.2)",bdt:"1px solid rgba(0,0,0,.1)",bdrad:"3px",boxShadow:"0 1px 4px rgba(0,0,0,.13)",bg:"#eee",pos:"relative",ov:"hidden",w:"100%","&:after":{content:'""',d:"block",padb:"100%"}},"@media (max-width: 600px)":{".chess-grid":{d:"none"}}}),Chessboard=_ref=>{let{...boardProps}=_ref;return react.createElement("div",{className:blockClass},react.createElement(chess_Board,boardProps))},chess_Chessboard=Chessboard;try{Chessboard.displayName="Chessboard",Chessboard.__docgenInfo={description:"",displayName:"Chessboard",props:{size:{defaultValue:null,description:"",name:"size",required:!1,type:{name:"enum",value:[{value:"0"},{value:"1"},{value:"2"},{value:"3"},{value:"-3"},{value:"-2"},{value:"-1"}]}},noRuler:{defaultValue:null,description:"",name:"noRuler",required:!1,type:{name:"boolean"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"((e: MouseEvent<Element, MouseEvent>) => void)"}},onRightClick:{defaultValue:null,description:"",name:"onRightClick",required:!1,type:{name:"((e: MouseEvent<Element, MouseEvent>) => void)"}},lines:{defaultValue:null,description:"",name:"lines",required:!1,type:{name:"ILine[]"}},squares:{defaultValue:null,description:"",name:"squares",required:!1,type:{name:"ISquare[]"}},borders:{defaultValue:null,description:"",name:"borders",required:!1,type:{name:"IBorder[]"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/markdown/components/chess/Chessboard/index.tsx#Chessboard"]={docgenInfo:Chessboard.__docgenInfo,name:"Chessboard",path:"src/markdown/components/chess/Chessboard/index.tsx#Chessboard"})}catch(__react_docgen_typescript_loader_error){}var MarkdownBlock=__webpack_require__("./src/markdown/util/MarkdownBlock.tsx"),context=__webpack_require__("./src/markdown/context.ts"),isFirstLevelBlockElement=__webpack_require__("./src/markdown/util/isFirstLevelBlockElement.ts"),MarkdownFullWidthBlock=__webpack_require__("./src/markdown/util/MarkdownFullWidthBlock.tsx");const{useState}=react_namespaceObject,FullWidthFenBlock_blockClass=(0,lib.rule)({cur:"pointer"}),wrapClass=(0,lib.rule)({mar:"0 auto",pad:"16px 32px"}),FullWidthFenBlock=props=>{const{idx,layout}=props,[full,setFull]=useState(!1),theme=(0,lib.useTheme)(),blockStyle={};full&&(blockStyle.background=theme.isLight?theme.g(.08):theme.g(.96));const wrapStyle={maxWidth:full?600:300};return full&&(wrapStyle.padding="32px"),react.createElement(MarkdownFullWidthBlock.Ay,{full:!0},react.createElement(MarkdownBlock.Ay,{idx,className:FullWidthFenBlock_blockClass,style:blockStyle,onClick:()=>setFull((f=>!f))},react.createElement("div",{className:wrapClass,style:wrapStyle},react.createElement(chess_Chessboard,layout))))},fen_FullWidthFenBlock=FullWidthFenBlock;try{FullWidthFenBlock.displayName="FullWidthFenBlock",FullWidthFenBlock.__docgenInfo={description:"",displayName:"FullWidthFenBlock",props:{idx:{defaultValue:null,description:"",name:"idx",required:!0,type:{name:"number"}},layout:{defaultValue:null,description:"",name:"layout",required:!0,type:{name:"IBoardLayout"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/markdown/block/fen/FullWidthFenBlock.tsx#FullWidthFenBlock"]={docgenInfo:FullWidthFenBlock.__docgenInfo,name:"FullWidthFenBlock",path:"src/markdown/block/fen/FullWidthFenBlock.tsx#FullWidthFenBlock"})}catch(__react_docgen_typescript_loader_error){}const{memo,useMemo,useContext}=react_namespaceObject,block_fen=memo((props=>{const{idx,source,renderError}=props,state=useContext(context._),node=state.ast.nodes[idx],parsed=useMemo((()=>{try{return parseExtended(source)}catch(error){return null}}),[source]);if(!parsed)return renderError(props,new Error("Could not parse."));if(state.props.isFullWidth&&(0,isFirstLevelBlockElement.A)(node,state.ast))return react.createElement(fen_FullWidthFenBlock,{idx,layout:parsed});let chessboard=react.createElement(chess_Chessboard,parsed);return state.props.isCompact&&(chessboard=react.createElement("div",{style:{maxWidth:300,margin:"0 auto"}},chessboard)),react.createElement(MarkdownBlock.Ay,{idx},chessboard)}));try{fen.displayName="fen",fen.__docgenInfo={description:"",displayName:"fen",props:{idx:{defaultValue:null,description:"",name:"idx",required:!0,type:{name:"number"}},source:{defaultValue:null,description:"",name:"source",required:!0,type:{name:"string"}},onError:{defaultValue:null,description:"",name:"onError",required:!1,type:{name:"((error: unknown) => void)"}},renderLoading:{defaultValue:null,description:"",name:"renderLoading",required:!1,type:{name:"((props: IMarkdownBlockProps) => ReactNode)"}},renderError:{defaultValue:null,description:"",name:"renderError",required:!0,type:{name:"(props: IMarkdownBlockProps, error?: Error | undefined) => ReactNode"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/markdown/block/fen/index.tsx#fen"]={docgenInfo:fen.__docgenInfo,name:"fen",path:"src/markdown/block/fen/index.tsx#fen"})}catch(__react_docgen_typescript_loader_error){}},"./src/misc/conf.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{s:()=>CDN});const CDN="http://localhost:62282"}}]);